import{A as ae,l as ft,a as oe,f as K,b as ce,c as st,d as Rt,m as O,g as le}from"./maps.js";const ue="modulepreload",pe=function(t){return"/"+t},At={},de=function(n,i,r){let o=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),s=(e==null?void 0:e.nonce)||(e==null?void 0:e.getAttribute("nonce"));o=Promise.allSettled(i.map(l=>{if(l=pe(l),l in At)return;At[l]=!0;const p=l.endsWith(".css"),a=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${a}`))return;const d=document.createElement("link");if(d.rel=p?"stylesheet":ue,p||(d.as="script"),d.crossOrigin="",d.href=l,s&&d.setAttribute("nonce",s),document.head.appendChild(d),p)return new Promise((_,m)=>{d.addEventListener("load",_),d.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function c(e){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=e,window.dispatchEvent(s),!s.defaultPrevented)throw e}return o.then(e=>{for(const s of e||[])s.status==="rejected"&&c(s.reason);return n().catch(c)})};function S(t=""){return t==null?"":String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function mt(){return new Date().toLocaleString()}function Dt(t=0){const n=Math.round(t/1e3),i=Math.floor(n/60),r=n%60;return`${i} ${i===1?"Minute":"Minutes"} and ${r} ${r===1?"Second":"Seconds"}`}function he(t){document.getElementById("result").innerHTML=`
    <div class="card">
      <div class="card__header">
        <h2 class="card__title">Looking up demographics…</h2>
        <span class="updated">Started ${mt()}</span>
      </div>
      ${t?`<p class="note">Address: <strong>${S(t)}</strong></p>`:""}
      <div class="callout">Fetching county, languages, English proficiency, population, income, DAC, and alerts…</div>
      <p class="note">Elapsed: <span id="searchTimer">0m 00s</span></p>
    </div>
  `}function $t(t,n,i){document.getElementById("result").innerHTML=`
    <div class="card" role="alert">
      <div class="card__header">
        <h2 class="card__title">Unable to retrieve data</h2>
        <span class="updated">${mt()}</span>
      </div>
      ${n?`<p class="note">Address: <strong>${S(n)}</strong></p>`:""}
      <div class="callout" style="border-left-color:#b45309;">
        ${S(t||"Please try again with a different address.")}
      </div>
      <p class="note">Search took ${Dt(i)}.</p>
      <p class="note">API base: <code>${S(ae)}</code>. If your API has a prefix, adjust <code>API_PATH</code>.</p>
    </div>
  `}var Ft;const St=((Ft=document.querySelector('meta[name="sentry-dsn"]'))==null?void 0:Ft.content)||"";St&&window.Sentry&&(window.Sentry.init({dsn:St}),ft("Sentry initialized"));window.addEventListener("error",t=>{var n;ft("window.onerror",t.message),(n=window.Sentry)==null||n.captureException(t.error||new Error(t.message||"Unknown error"))});window.addEventListener("unhandledrejection",t=>{var n;ft("unhandledrejection",t.reason),(n=window.Sentry)==null||n.captureException(t.reason)});let V=null;const ut=new Map;function fe(){window.print()}window.printReport=fe;function me(){if(!V)return;const t=new Blob([JSON.stringify(V,null,2)],{type:"application/json"}),n=URL.createObjectURL(t),i=document.createElement("a"),r=(V.address||"report").replace(/[^a-z0-9]+/gi,"_").toLowerCase();i.href=n,i.download=`calwep_report_${r}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}window.downloadRawData=me;window.downloadPdf=async function(){const{downloadPdf:t}=await de(async()=>{const{downloadPdf:n}=await import("./pdf.js");return{downloadPdf:n}},[]);t(V)};function ge(){const t=window.location.href;navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(t).then(()=>alert("Link copied to clipboard")).catch(()=>{prompt("Copy this link:",t)}):prompt("Copy this link:",t)}window.shareReport=ge;function T(t){return t==null||Number(t)===-888888888}function _e(t){return!T(t)&&Number.isFinite(Number(t))?Number(t).toLocaleString():"—"}function pt(t){return T(t)||!Number.isFinite(Number(t))?"—":`$${Math.round(Number(t)).toLocaleString()}`}function ye(t){return!T(t)&&Number.isFinite(Number(t))?Number(t).toLocaleString(void 0,{maximumFractionDigits:1}):"—"}function E(t){return!T(t)&&Number.isFinite(Number(t))?`${Number(t).toFixed(1)}%`:"—"}function ve(t=""){return t.replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase())}function tt(t={},...n){const i=r=>r&&typeof r=="object"&&!Array.isArray(r);for(const r of n)if(i(r))for(const[o,c]of Object.entries(r))i(c)?t[o]=tt(i(t[o])?t[o]:{},c):t[o]=c;return t}function nt(t=[],n=50){const i=[];for(let r=0;r<t.length;r+=n)i.push(t.slice(r,r+n));return i}const we={pm25:"PM2.5",diesel:"Diesel PM",toxic_releases:"Toxic releases",drinking_water:"Drinking water",cleanup_sites:"Cleanup sites",groundwater_threats:"Groundwater threats",hazardous_waste:"Hazardous waste",impaired_waters:"Impaired waters",solid_waste:"Solid waste",low_birth_weight:"Low birth weight",cardiovascular_disease:"Cardiovascular disease",linguistic_isolation:"Linguistic isolation",housing_burden:"Housing burden"},Q={exposures:["ozone","pm25","diesel","toxic_releases","traffic","pesticides","drinking_water","lead"],environmental_effects:["cleanup_sites","groundwater_threats","hazardous_waste","impaired_waters","solid_waste"],sensitive_populations:["asthma","low_birth_weight","cardiovascular_disease"],socioeconomic_factors:["education","linguistic_isolation","poverty","unemployment","housing_burden"]};let et=null,Y=null;function be(){Y=Date.now();const t=n=>{const i=document.getElementById("searchTimer");i&&(i.textContent=n);const r=document.getElementById("spinnerTime");r&&(r.textContent=n)};t("0m 00s"),et=setInterval(()=>{if(!Y)return;const n=Date.now()-Y,i=Math.floor(n/1e3%60),r=Math.floor(n/6e4);t(`${r}m ${i.toString().padStart(2,"0")}s`)},1e3)}function Et(){et&&clearInterval(et);const t=Y?Date.now()-Y:0;return et=null,Y=null,t}async function Ae(t={}){let{city:n,census_tract:i,lat:r,lon:o,state_fips:c,county_fips:e,tract_code:s}=t;const l=[];return!n&&r!=null&&o!=null&&l.push(fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${r}&longitude=${o}&localityLanguage=en`).then(p=>p.json()).then(p=>{var d,_;n=(Array.isArray((d=p==null?void 0:p.localityInfo)==null?void 0:d.administrative)?(_=p.localityInfo.administrative.find(m=>m.order===8||m.adminLevel===8))==null?void 0:_.name:null)||p.city||p.locality||n}).catch(()=>{})),(!i||!c||!e||!s)&&r!=null&&o!=null&&l.push(fetch(`https://geo.fcc.gov/api/census/block/find?latitude=${r}&longitude=${o}&format=json`).then(p=>p.json()).then(p=>{var d;const a=(d=p==null?void 0:p.Block)==null?void 0:d.FIPS;a&&a.length>=11&&(c=a.slice(0,2),e=a.slice(2,5),s=a.slice(5,11),i=`${s.slice(0,4)}.${s.slice(4)}`)}).catch(()=>{})),l.length&&await Promise.all(l),{...t,city:n,census_tract:i,state_fips:c,county_fips:e,tract_code:s}}let J=null;async function Tt(){if(J)return J;try{const t=await K("https://api.census.gov/data/2022/acs/acs5/groups/C16001.json"),n=(t==null?void 0:t.variables)||{},i=[],r={};for(const[o,c]of Object.entries(n)){if(!o.endsWith("E"))continue;const e=c.label||"",s=/^Estimate!!Total:!!([^:]+):$/.exec(e);s&&(i.push(o),r[o]=s[1])}J={codes:i,names:r}}catch{J={codes:[],names:{}}}return J}async function ht(t=[]){var _,m;const{codes:n,names:i}=await Tt();if(!n.length)return{};const r={};for(const h of t){const y=String(h).replace(/[^0-9]/g,"").padStart(11,"0");if(y.length!==11)continue;const f=y.slice(0,2),u=y.slice(2,5),g=y.slice(5),v=`${f}${u}`;r[v]||(r[v]={state:f,county:u,tracts:[]}),r[v].tracts.push(g)}let o=0,c=0,e=0;const s={},l=Object.values(r).map(async h=>{const y=nt(h.tracts,50),f=await Promise.all(y.map(async g=>{const v=g.join(","),b=40,A=[];for(let $=0;$<n.length;$+=b){const I=n.slice($,$+b),x=`https://api.census.gov/data/2022/acs/acs5?get=${($===0?["C16001_001E","C16001_002E",...I]:I).join(",")}&for=tract:${v}&in=state:${h.state}%20county:${h.county}`;A.push(fetch(x).then(B=>B.json()).then(B=>({type:"lang",rows:B,chunk:I})).catch(()=>null))}const F=`https://api.census.gov/data/2022/acs/acs5/profile?get=DP02_0115E&for=tract:${v}&in=state:${h.state}%20county:${h.county}`;A.push(fetch(F).then($=>$.json()).then($=>({type:"english",rows:$})).catch(()=>null));const k=await Promise.all(A);let R=0,N=0,D=0;const L={};for(const $ of k){if(!$||!Array.isArray($.rows)||$.rows.length<=1)continue;const{rows:I}=$;if($.type==="lang"){const q=I[0];for(let x=1;x<I.length;x++){const B=I[x],G={};q.forEach((j,H)=>G[j]=Number(B[H])),R+=G.C16001_001E||0,N+=G.C16001_002E||0;for(const j of $.chunk){const H=i[j],X=G[j]||0;H&&(L[H]=(L[H]||0)+X)}}}else if($.type==="english"){const q=I[0];for(let x=1;x<I.length;x++){const B=I[x],G={};q.forEach((j,H)=>G[j]=Number(B[H])),D+=G.DP02_0115E||0}}}return{total:R,englishOnly:N,englishLess:D,langCounts:L}})),u={total:0,englishOnly:0,englishLess:0,langCounts:{}};for(const g of f){u.total+=g.total,u.englishOnly+=g.englishOnly,u.englishLess+=g.englishLess;for(const[v,b]of Object.entries(g.langCounts))u.langCounts[v]=(u.langCounts[v]||0)+b}return u}),p=await Promise.all(l);for(const h of p){o+=h.total,c+=h.englishOnly,e+=h.englishLess;for(const[y,f]of Object.entries(h.langCounts))s[y]=(s[y]||0)+f}s.English=c;const a=s.Spanish||0,d=Object.entries(s).sort((h,y)=>y[1]-h[1]);return{primary_language:(_=d[0])==null?void 0:_[0],secondary_language:(m=d[1])==null?void 0:m[0],language_other_than_english_pct:o?(o-c)/o*100:null,english_less_than_very_well_pct:o?e/o*100:null,spanish_at_home_pct:o?a/o*100:null}}async function $e({state_fips:t,county_fips:n,tract_code:i}={}){if(!t||!n||!i)return{};const r=`${t}${n}${i}`;return ht([r])}async function kt(t=[]){const n={};for(const l of t){const p=String(l).replace(/[^0-9]/g,"").padStart(11,"0");if(p.length!==11)continue;const a=p.slice(0,2),d=p.slice(2,5),_=p.slice(5),m=`${a}${d}`;n[m]||(n[m]={state:a,county:d,tracts:[]}),n[m].tracts.push(_)}let i=0,r=0,o=0,c=0,e=0;for(const l of Object.values(n)){const p=nt(l.tracts,50);for(const a of p){const d="https://api.census.gov/data/2022/acs/acs5/profile?get=DP05_0001E,DP05_0018E,DP03_0062E,DP03_0088E,DP03_0128PE&for=tract:"+a.join(",")+`&in=state:${l.state}%20county:${l.county}`;try{const _=await fetch(d).then(m=>m.json());if(!Array.isArray(_)||_.length<2)continue;for(let m=1;m<_.length;m++){const[h,y,f,u,g]=_[m].map(Number);Number.isFinite(h)&&h>0&&(i+=h,Number.isFinite(y)&&(r+=y*h),Number.isFinite(f)&&(o+=f*h),Number.isFinite(u)&&(c+=u*h),Number.isFinite(g)&&g>=0&&(e+=g/100*h))}}catch{}}}const s={};return i>0&&(s.population=i,r>0&&(s.median_age=r/i),o>0&&(s.median_household_income=o/i),c>0&&(s.per_capita_income=c/i),e>0&&(s.poverty_rate=e/i*100)),s}async function Ct(t=[]){const n={};for(const d of t){const _=String(d).replace(/[^0-9]/g,"").padStart(11,"0");if(_.length!==11)continue;const m=_.slice(0,2),h=_.slice(2,5),y=_.slice(5),f=`${m}${h}`;n[f]||(n[f]={state:m,county:h,tracts:[]}),n[f].tracts.push(y)}let i=0,r=0,o=0,c=0,e=0,s=0,l=0;for(const d of Object.values(n)){const _=nt(d.tracts,50);for(const m of _){const h="https://api.census.gov/data/2022/acs/acs5/profile?get="+["DP04_0045E","DP04_0046E","DP04_0047E","DP04_0089E","DP02_0059E","DP02_0067E","DP02_0068E"].join(",")+"&for=tract:"+m.join(",")+`&in=state:${d.state}%20county:${d.county}`;try{const y=await fetch(h).then(f=>f.json());if(!Array.isArray(y)||y.length<2)continue;for(let f=1;f<y.length;f++){const[u,g,v,b,A,F,k]=y[f].slice(0,7).map(Number);Number.isFinite(u)&&u>0&&(i+=u),Number.isFinite(g)&&g>0&&(r+=g,Number.isFinite(b)&&b>0&&(c+=b*g)),Number.isFinite(v)&&v>0&&(o+=v),Number.isFinite(A)&&A>0&&(e+=A,Number.isFinite(F)&&F>0&&(s+=F),Number.isFinite(k)&&k>0&&(l+=k))}}catch{}}}const p={},a=r+o;return a>0&&(p.owner_occupied_pct=r/a*100,p.renter_occupied_pct=o/a*100),r>0&&c>0&&(p.median_home_value=c/r),e>0&&(p.high_school_or_higher_pct=s/e*100,p.bachelors_or_higher_pct=l/e*100),p}async function gt(t=[]){const n={};for(const r of t){const o=String(r).replace(/[^0-9]/g,"").padStart(11,"0");if(o.length!==11)continue;const c=o.slice(0,2),e=o.slice(2,5),s=o.slice(5),l=`${c}${e}`;n[l]||(n[l]={state:c,county:e,tracts:[]}),n[l].tracts.push(s)}const i={};for(const r of Object.values(n)){const o=nt(r.tracts,50);for(const c of o){const e="https://api.census.gov/data/2022/acs/acs5/profile?get=DP03_0009PE,DP05_0001E&for=tract:"+c.join(",")+`&in=state:${r.state}%20county:${r.county}`;try{const s=await fetch(e).then(l=>l.json());if(!Array.isArray(s)||s.length<2)continue;for(let l=1;l<s.length;l++){const[p,a,d,_,m]=s[l],h=`${d}${_}${m}`;i[h]={unemployment_rate:Number(p),population:Number(a)}}}catch{}}}return i}async function Lt(t=[]){const n="https://gis.water.ca.gov/arcgis/rest/services/Society/i16_Census_Tract_DisadvantagedCommunities_2020/MapServer/0/query",i=new Set,r=50;for(let o=0;o<t.length;o+=r){const c=t.slice(o,o+r);if(!c.length)continue;const e=`GEOID20 IN (${c.map(l=>`'${l}'`).join(",")})`,s=n+`?where=${encodeURIComponent(e)}&outFields=GEOID20,DAC20&returnGeometry=false&f=json`;try{const l=await fetch(s).then(p=>p.json());for(const p of l.features||[]){const a=p.attributes||{},d=String(a.GEOID20);String(a.DAC20||"").toUpperCase()==="Y"&&i.add(d)}}catch{}}return Array.from(i)}async function Pt(t=[]){const n=new Set;return await Promise.all(t.map(async i=>{try{const r=st(Rt,{fips:i,census_tract:i,geoid:i}),o=await K(r);Array.isArray(o.environmental_hardships)&&o.environmental_hardships.forEach(c=>n.add(c))}catch{}})),Array.from(n).sort()}async function Se(t={}){var s,l;const{surrounding_10_mile:n,water_district:i}=t||{},r={...t},o=n||{};if(Array.isArray(o.census_tracts_fips)&&o.census_tracts_fips.length){const p=await kt(o.census_tracts_fips),a=o.demographics||{};r.surrounding_10_mile={...o,demographics:{...a,...p}}}const c=i||{},e=Array.isArray(c.census_tracts_fips)?c.census_tracts_fips.map(String):[];if(e.length){const p=await kt(e),a=c.demographics||{},d=(l=(s=r.surrounding_10_mile)==null?void 0:s.demographics)==null?void 0:l.median_household_income,_={...a,...p};d!=null&&(!Number.isFinite(_.median_household_income)||_.median_household_income<0)&&(_.median_household_income=d),r.water_district={...c,demographics:_}}return r}async function Ee(t={}){var s,l;const{surrounding_10_mile:n,water_district:i}=t||{},r={...t},o=n||{};if(Array.isArray(o.census_tracts_fips)&&o.census_tracts_fips.length){const p=o.demographics||{};if([p.owner_occupied_pct,p.renter_occupied_pct,p.median_home_value,p.high_school_or_higher_pct,p.bachelors_or_higher_pct].some(d=>T(d)||typeof d=="number"&&d<0)){const d=await Ct(o.census_tracts_fips);r.surrounding_10_mile={...o,demographics:{...p,...d}}}}const c=i||{},e=Array.isArray(c.census_tracts_fips)?c.census_tracts_fips.map(String):[];if(e.length){const p=c.demographics||{};if([p.owner_occupied_pct,p.renter_occupied_pct,p.median_home_value,p.high_school_or_higher_pct,p.bachelors_or_higher_pct].some(d=>T(d)||typeof d=="number"&&d<0)){const d=await Ct(e);let _={...p,...d};const m=(l=(s=r.surrounding_10_mile)==null?void 0:s.demographics)==null?void 0:l.median_home_value;m!=null&&(!Number.isFinite(_.median_home_value)||_.median_home_value<0)&&(_.median_home_value=m),r.water_district={...c,demographics:_}}}return r}async function ke(t={}){const{state_fips:n,county_fips:i,tract_code:r,unemployment_rate:o,surrounding_10_mile:c,water_district:e}=t||{},s=c||{},l=e||{},p=[],a=n&&i&&r?`${n}${i}${r}`:null;T(o)&&a&&p.push(a);const d=Array.isArray(s.census_tracts_fips)?s.census_tracts_fips:[];s.demographics&&T(s.demographics.unemployment_rate)&&d.length&&p.push(...d);const _=Array.isArray(l.census_tracts_fips)?l.census_tracts_fips.map(String):[];l.demographics&&T(l.demographics.unemployment_rate)&&_.length&&p.push(..._);const m=Array.from(new Set(p));if(!m.length)return t;const h=await gt(m),y={...t};if(T(o)&&a&&h[a]&&(y.unemployment_rate=h[a].unemployment_rate),s.demographics&&T(s.demographics.unemployment_rate)&&d.length){let f=0,u=0;for(const g of d){const v=h[g];v&&Number.isFinite(v.unemployment_rate)&&Number.isFinite(v.population)&&(f+=v.population,u+=v.unemployment_rate*v.population)}f>0&&(y.surrounding_10_mile={...s,demographics:{...s.demographics,unemployment_rate:u/f}})}if(l.demographics&&T(l.demographics.unemployment_rate)&&_.length){let f=0,u=0;for(const g of _){const v=h[g];v&&Number.isFinite(v.unemployment_rate)&&Number.isFinite(v.population)&&(f+=v.population,u+=v.unemployment_rate*v.population)}f>0&&(y.water_district={...l,demographics:{...l.demographics,unemployment_rate:u/f}})}return y}async function Ce(t={}){const{surrounding_10_mile:n,water_district:i}=t||{},r={...t},o=n||{};if(Array.isArray(o.census_tracts_fips)&&o.census_tracts_fips.length){const s=await ht(o.census_tracts_fips),l=o.demographics||{};r.surrounding_10_mile={...o,demographics:{...l,...s}}}const c=i||{},e=Array.isArray(c.census_tracts_fips)?c.census_tracts_fips.map(String):[];if(e.length){const s=await ht(e),l=c.demographics||{};r.water_district={...c,demographics:{...l,...s}}}return r}async function Pe(t={}){const{surrounding_10_mile:n,water_district:i}=t||{},r={...t},o=n||{},c=Array.isArray(o.census_tracts_fips)&&o.census_tracts_fips.length?o.census_tracts_fips:Array.isArray(o.census_tracts)?o.census_tracts:[];if((!Array.isArray(o.environmental_hardships)||!o.environmental_hardships.length)&&c.length){const l=await Pt(c);r.surrounding_10_mile={...o,environmental_hardships:l}}const e=i||{},s=Array.isArray(e.census_tracts_fips)?e.census_tracts_fips.map(String):[];if((!Array.isArray(e.environmental_hardships)||!e.environmental_hardships.length)&&s.length){const l=await Pt(s);r.water_district={...e,environmental_hardships:l}}return r}async function Ne(t={}){const{lat:n,lon:i,census_tract:r,surrounding_10_mile:o}=t||{};if(n==null||i==null)return t;const c=1609.34*10,e={...o||{}},s=[];if(!Array.isArray(e.cities)||!e.cities.length){const m=`[out:json];(node[place=city](around:${c},${n},${i});node[place=town](around:${c},${n},${i}););out;`,h="https://overpass-api.de/api/interpreter?data="+encodeURIComponent(m);s.push(fetch(h).then(y=>y.json()).then(y=>{const f=(y.elements||[]).map(u=>{var g;return(g=u.tags)==null?void 0:g.name}).filter(Boolean);e.cities=Array.from(new Set(f)).slice(0,10)}).catch(()=>{}))}const l=Array.isArray(e.census_tracts)?e.census_tracts.map(String):[],p=Array.isArray(e.census_tracts_fips)?e.census_tracts_fips.map(String):[],a={...e.census_tract_map||{}},d=`https://tigerweb.geo.census.gov/arcgis/rest/services/TIGERweb/Tracts_Blocks/MapServer/10/query?where=1=1&geometry=${i},${n}&geometryType=esriGeometryPoint&inSR=4326&spatialRel=esriSpatialRelIntersects&distance=${c}&units=esriSRUnit_Meter&outFields=NAME,GEOID&f=json`;s.push(fetch(d).then(m=>m.json()).then(m=>{const h=m.features||[],y=[],f=[],u={};for(const g of h){const v=g.attributes||{};let b=null;if(v.NAME&&(b=v.NAME.replace(/^Census Tract\s+/i,""),y.push(b)),v.GEOID){const A=String(v.GEOID);f.push(A),b&&(u[A]=b)}}e.census_tracts=Array.from(new Set([...l,...y])),e.census_tracts_fips=Array.from(new Set([...p,...f])),e.census_tract_map={...a,...u}}).catch(()=>{})),s.length&&await Promise.all(s),Array.isArray(e.cities)||(e.cities=[]);const _=new Set(Array.isArray(e.census_tracts)?e.census_tracts:[]);if(r&&_.add(String(r)),e.census_tracts=Array.from(_),Array.isArray(e.census_tracts_fips)){const m=new Set(e.census_tracts_fips),{state_fips:h,county_fips:y,tract_code:f}=t||{};h&&y&&f&&m.add(`${h}${y}${f}`),e.census_tracts_fips=Array.from(m)}if(Array.isArray(e.census_tracts_fips)&&e.census_tracts_fips.length)try{const m=await Lt(e.census_tracts_fips),h=[];for(const y of m){const f=e.census_tract_map&&e.census_tract_map[y]||y;h.push(f)}if(e.dac_tracts=h,e.dac_tracts_fips=m,h.length){const y=new Set([...e.census_tracts||[],...h]);e.census_tracts=Array.from(y)}}catch{}if(Array.isArray(e.census_tracts_fips)&&e.census_tracts_fips.length)try{const m=await gt(e.census_tracts_fips);let h=0,y=0;const f=new Set(e.dac_tracts_fips||[]);for(const u of e.census_tracts_fips){const g=m[u];g&&Number.isFinite(g.population)&&(h+=g.population,f.has(String(u))&&(y+=g.population))}h>0&&(e.dac_population_pct=y/h*100),e.census_tracts_fips.length>0&&(e.dac_tracts_pct=f.size/e.census_tracts_fips.length*100)}catch{}return{...t,surrounding_10_mile:e}}async function Fe(t={},n=""){var h,y;const{lat:i,lon:r,city:o,census_tract:c,state_fips:e,county_fips:s,tract_code:l,water_district:p}=t||{};if(i==null||r==null)return t;const a={...p},d=[];if(n){const f=st("/lookup",{address:n});d.push(K(f).then(u=>{var v,b,A,F;a.name=((v=u==null?void 0:u.agency)==null?void 0:v.agency_name)||((b=u==null?void 0:u.agency)==null?void 0:b.name)||(u==null?void 0:u.agency_name)||(u==null?void 0:u.name)||a.name;const g=((A=u==null?void 0:u.agency)==null?void 0:A.service_area_tracts)||(u==null?void 0:u.service_area_tracts)||(u==null?void 0:u.census_tracts)||((F=u==null?void 0:u.agency)==null?void 0:F.census_tracts);if(typeof g=="string"){const k=g.split(/\s*,\s*/).filter(Boolean);a.census_tracts=k;const R=k.filter(N=>/^\d{11}$/.test(N));R.length&&(a.census_tracts_fips=R)}else if(Array.isArray(g)){const k=[...new Set(g.map(String))];a.census_tracts=k;const R=k.filter(N=>/^\d{11}$/.test(N));R.length&&(a.census_tracts_fips=[...new Set([...a.census_tracts_fips||[],...R])])}}).catch(()=>{}))}if(!a.name){const f=`https://services.arcgis.com/8DFNJhY7CUN8E0bX/ArcGIS/rest/services/Public_Water_System_Boundaries/FeatureServer/0/query?geometry=${r}%2C${i}&geometryType=esriGeometryPoint&inSR=4326&spatialRel=esriSpatialRelIntersects&outFields=PWS_NAME&returnGeometry=false&f=json`;d.push(fetch(f).then(u=>u.json()).then(u=>{var g,v,b;a.name=((b=(v=(g=u==null?void 0:u.features)==null?void 0:g[0])==null?void 0:v.attributes)==null?void 0:b.PWS_NAME)||a.name}).catch(()=>{}))}if((!Array.isArray(a.cities)||!a.cities.length)&&o&&(a.cities=[o]),d.length&&await Promise.all(d),a.name&&(!Array.isArray(a.census_tracts)||!a.census_tracts.length))try{const f=st("/census-tracts",{agency_name:a.name}),u=await K(f),g=u==null?void 0:u.census_tracts;Array.isArray(g)&&(a.census_tracts=[...new Set(g.map(String))])}catch{}try{const f=`https://services.arcgis.com/8DFNJhY7CUN8E0bX/ArcGIS/rest/services/Public_Water_System_Boundaries/FeatureServer/0/query?geometry=${r}%2C${i}&geometryType=esriGeometryPoint&inSR=4326&spatialRel=esriSpatialRelIntersects&outFields=PWS_NAME&returnGeometry=true&outSR=4326&f=json`,u=await fetch(f).then(v=>v.json()),g=(y=(h=u==null?void 0:u.features)==null?void 0:h[0])==null?void 0:y.geometry;if(g){const v="https://tigerweb.geo.census.gov/arcgis/rest/services/TIGERweb/Tracts_Blocks/MapServer/10/query",b=new URLSearchParams({where:"1=1",geometry:JSON.stringify(g),geometryType:"esriGeometryPolygon",inSR:"4326",spatialRel:"esriSpatialRelIntersects",outFields:"NAME,GEOID",returnGeometry:"false",f:"json"});let A;try{A=await fetch(v,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:b.toString()}).then(N=>N.json())}catch{const N=`${v}?${b.toString()}`;A=await fetch(N).then(D=>D.json())}const F=[],k=[],R={};for(const N of A.features||[]){const D=N.attributes||{};let L=null;if(D.NAME&&(L=D.NAME.replace(/^Census Tract\s+/i,""),F.push(L)),D.GEOID){const $=String(D.GEOID);k.push($),L&&(R[$]=L)}}if(F.length||k.length){const N=Array.isArray(a.census_tracts)?a.census_tracts.map(String):[],D=Array.isArray(a.census_tracts_fips)?a.census_tracts_fips.map(String):[],L=a.census_tract_map||{};F.length&&(a.census_tracts=[...new Set([...N,...F])]),k.length&&(a.census_tracts_fips=[...new Set([...D,...k])]),Object.keys(R).length&&(a.census_tract_map={...L,...R})}}}catch{}let _=[];Array.isArray(a.census_tracts)?_=a.census_tracts.map(String):typeof a.census_tracts=="string"&&(_=a.census_tracts.split(/\s*,\s*/).filter(Boolean)),c&&_.unshift(String(c)),a.census_tracts=[...new Set(_)];let m=Array.isArray(a.census_tracts_fips)?a.census_tracts_fips.map(String):[];for(const f of a.census_tracts)if(/^\d{11}$/.test(f))m.push(f);else if(e&&s){const u=String(f).replace(/[^0-9]/g,"");if(u){const g=u.padStart(6,"0").slice(-6);m.push(`${e}${s}${g}`)}}if(e&&s&&l&&m.unshift(`${e}${s}${l}`),a.census_tracts_fips=[...new Set(m)],Array.isArray(a.census_tracts_fips)&&a.census_tracts_fips.length)try{const f=await Lt(a.census_tracts_fips),u=[];for(const g of f){const v=a.census_tract_map&&a.census_tract_map[g]||g;u.push(v)}if(a.dac_tracts=u,a.dac_tracts_fips=f,u.length){const g=new Set([...a.census_tracts||[],...u]);a.census_tracts=Array.from(g)}}catch{}if(Array.isArray(a.census_tracts_fips)&&a.census_tracts_fips.length)try{const f=await gt(a.census_tracts_fips);let u=0,g=0;const v=new Set(a.dac_tracts_fips||[]);for(const b of a.census_tracts_fips){const A=f[b];A&&Number.isFinite(A.population)&&(u+=A.population,v.has(String(b))&&(g+=A.population))}u>0&&(a.dac_population_pct=g/u*100),a.census_tracts_fips.length>0&&(a.dac_tracts_pct=v.size/a.census_tracts_fips.length*100)}catch{}return a.environment={percentile:48.5,overall_percentiles:{pollution_burden:37.2,population_characteristics:56.5},exposures:{ozone:98.8,pm25:34,diesel:24.2,toxic_releases:32.7,traffic:12.3,pesticides:22.7,drinking_water:61.8,lead:49.1},environmental_effects:{cleanup_sites:25.2,groundwater_threats:20.4,hazardous_waste:27.8,impaired_waters:23,solid_waste:45.7},sensitive_populations:{asthma:58.9,low_birth_weight:52.8,cardiovascular_disease:81.6},socioeconomic_factors:{education:45.5,linguistic_isolation:17,poverty:54.5,unemployment:63.2,housing_burden:38.8}},{...t,water_district:a}}async function Re(t={}){var o,c;const{lat:n,lon:i,english_less_than_very_well_pct:r}=t||{};if(!T(r)||n==null||i==null)return t;try{const e=await fetch(`https://geo.fcc.gov/api/census/block/find?latitude=${n}&longitude=${i}&format=json`).then(l=>l.json()),s=(o=e==null?void 0:e.Block)==null?void 0:o.FIPS;if(s&&s.length>=11){const l=s.slice(0,2),p=s.slice(2,5),d=`https://api.census.gov/data/2022/acs/acs5/profile?get=DP02_0111PE&for=tract:${s.slice(5,11)}&in=state:${l}+county:${p}`,_=await fetch(d).then(y=>y.json()),m=(c=_==null?void 0:_[1])==null?void 0:c[0],h=Number(m);if(Number.isFinite(h)&&h>=0)return{...t,english_less_than_very_well_pct:h}}}catch{}return t}async function De(t={}){const{lat:n,lon:i}=t||{};if(n==null||i==null)return{...t,alerts:[]};try{const r=`https://api.weather.gov/alerts/active?point=${n},${i}`,o=await fetch(r,{headers:{Accept:"application/geo+json","User-Agent":"CalWEP-Demographic-Website (info@calwep.org)"}});if(!o.ok)throw new Error("NWS response not ok");const c=await o.json(),e=Array.isArray(c==null?void 0:c.features)?c.features.map(s=>{var l;return(l=s==null?void 0:s.properties)==null?void 0:l.headline}).filter(Boolean):[];return{...t,alerts:e}}catch{return{...t,alerts:[]}}}function Te(t){const n=Number(t);if(!Number.isFinite(n))return{bg:"#fff",fg:"#000"};const i=[{max:10,color:"#006837",fg:"#fff"},{max:20,color:"#1A9850",fg:"#fff"},{max:30,color:"#66BD63"},{max:40,color:"#A6D96A"},{max:50,color:"#FEE08B"},{max:60,color:"#FDAE61"},{max:70,color:"#F46D43",fg:"#fff"},{max:80,color:"#D73027",fg:"#fff"},{max:90,color:"#A50026",fg:"#fff"},{max:100,color:"#6E0000",fg:"#fff"}];for(const r of i)if(n<=r.max)return{bg:r.color,fg:r.fg||"#000"};return{bg:"#6E0000",fg:"#fff"}}function z(t,n,i,r,o=""){const c=e=>e&&String(e).trim()?e:'<p class="note">No data</p>';return`
    <section class="section-block">
      <h3 class="section-header">${t}</h3>
      ${o}
      <div class="comparison-grid">
        <div class="col local">${c(n)}</div>
        <div class="col surrounding">${c(i)}</div>
        <div class="col district">${c(r)}</div>
      </div>
    </section>
  `}function dt(t){var e,s;if(!t||typeof t!="object")return'<p class="note">No data</p>';const n=l=>{const{bg:p,fg:a}=Te(l),d=Number.isFinite(Number(l))?Number(l).toFixed(1):"—";return`<span class="ces-badge" style="background:${p};color:${a};">${d}</span>`},i=t.percentile,r=(e=t.overall_percentiles)==null?void 0:e.pollution_burden,o=(s=t.overall_percentiles)==null?void 0:s.population_characteristics,c=(l,p,a=[])=>{if(!p||typeof p!="object")return"";const _=Object.entries(p).sort(([m],[h])=>{const y=a.indexOf(m),f=a.indexOf(h);return y!==-1&&f!==-1?y-f:y!==-1?-1:f!==-1?1:m.localeCompare(h)}).map(([m,h])=>`<div class="key">${S(we[m]||ve(m))}</div><div class="val">${n(h)}</div>`).join("");return`<h4 class="sub-section-header">${l}</h4><div class="kv">${_}</div>`};return`
    <div class="kv">
      <div class="key">Overall percentile</div><div class="val">${n(i)}</div>
      <div class="key">Pollution burden</div><div class="val">${n(r)}</div>
      <div class="key">Population characteristics</div><div class="val">${n(o)}</div>
    </div>
    ${c("Exposures",t.exposures,Q.exposures)}
    ${c("Environmental effects",t.environmental_effects,Q.environmental_effects)}
    ${c("Sensitive populations",t.sensitive_populations,Q.sensitive_populations)}
    ${c("Socioeconomic factors",t.socioeconomic_factors,Q.socioeconomic_factors)}
  `}function Nt(t,n,i){const{city:r,zip:o,county:c,census_tract:e,lat:s,lon:l,english_less_than_very_well_pct:p,language_other_than_english_pct:a,spanish_at_home_pct:d,primary_language:_,secondary_language:m,median_household_income:h,per_capita_income:y,median_age:f,poverty_rate:u,unemployment_rate:g,population:v,dac_status:b,environmental_hardships:A,white_pct:F,black_pct:k,native_pct:R,asian_pct:N,pacific_pct:D,other_race_pct:L,two_or_more_races_pct:$,hispanic_pct:I,not_hispanic_pct:q,owner_occupied_pct:x,renter_occupied_pct:B,median_home_value:G,high_school_or_higher_pct:j,bachelors_or_higher_pct:H,alerts:X,enviroscreen:xt,surrounding_10_mile:Ot,water_district:Mt}=n||{},_t=Array.isArray(A)?Array.from(new Set(A)):[],yt=Array.isArray(X)?X:[],Ut=s!=null&&l!=null?`${Number(s).toFixed(6)}, ${Number(l).toFixed(6)}`:"—",Bt=s!=null&&l!=null?`<img class="map-image" src="https://maps.googleapis.com/maps/api/staticmap?center=${s},${l}&zoom=13&size=600x300&markers=color:red|${s},${l}&key=${le()}" alt="Map of location" />`:"",P=Ot||{},C=Mt||{},vt=Array.isArray(P.environmental_hardships)?Array.from(new Set(P.environmental_hardships)):[],wt=Array.isArray(C.environmental_hardships)?Array.from(new Set(C.environmental_hardships)):[],Gt=Array.isArray(P.census_tracts)?P.census_tracts.join(", "):S(P.census_tracts)||"—",Ht=Array.isArray(P.cities)?P.cities.join(", "):S(P.cities)||"—",Wt=Array.isArray(C.census_tracts)?C.census_tracts.join(", "):S(C.census_tracts)||"—",jt=Array.isArray(C.cities)?C.cities.join(", "):S(C.cities)||"—",zt=`
    <div class="kv">
      <div class="key">City</div><div class="val">${S(r)||"—"}</div>
      <div class="key">Census tract</div><div class="val">${S(e)||"—"}</div>
      <div class="key">ZIP code</div><div class="val">${S(o)||"—"}</div>
      <div class="key">County</div><div class="val">${S(c)||"—"}</div>
      <div class="key">Coordinates</div><div class="val">${Ut}</div>
    </div>
    ${Bt}
  `,qt=`
    <div class="kv">
      <div class="key">Cities</div><div class="val">${Ht}</div>
      <div class="key">Census tracts</div><div class="val">${Gt}</div>
    </div>
  `,Vt=`
    <div class="kv">
      <div class="key">District</div><div class="val">${S(C.name)||"—"}</div>
      <div class="key">Cities</div><div class="val">${jt}</div>
      <div class="key">Census tracts</div><div class="val">${Wt}</div>
    </div>
  `,Yt=z("Location Summary",zt,qt,Vt,'<p class="section-description">This section lists basic geographic information for the census tract, surrounding 10&#8209;mile area, and water district, such as city, ZIP code, county, and coordinates.</p>'),it=(w={})=>`<div class="kv">${[["Total population",_e(w.population)],["Median age",ye(w.median_age)],["Median household income",pt(w.median_household_income)],["Per capita income",pt(w.per_capita_income)],["Poverty rate",E(w.poverty_rate)],["Unemployment rate",E(w.unemployment_rate)]].map(([M,U])=>`<div class="key">${M}</div><div class="val">${U}</div>`).join("")}</div>`,Jt=z("Population &amp; Income (ACS)",it({population:v,median_age:f,median_household_income:h,per_capita_income:y,poverty_rate:u,unemployment_rate:g}),it(P.demographics||{}),it(C.demographics||{}),'<p class="section-description">This section provides a snapshot of the people living in the selected area, drawn from the American Community Survey (ACS). It includes the total population, median age, household income, poverty rate, and unemployment rate. These indicators offer a quick view of community size, economic stability, and social conditions.</p><p class="section-description"><em>Values for the surrounding 10-mile area and water district are population-weighted averages.</em></p>'),rt=(w={})=>`<div class="kv">${[["Primary language",S(w.primary_language)||"—"],["Second most common",S(w.secondary_language)||"—"],["People who speak a language other than English at home",E(w.language_other_than_english_pct)],['People who speak English less than "very well"',E(w.english_less_than_very_well_pct)],["People who speak Spanish at home",E(w.spanish_at_home_pct)]].map(([M,U])=>`<div class="key">${M}</div><div class="val">${U}</div>`).join("")}</div>`,Kt=z("Language (ACS)",rt({primary_language:_,secondary_language:m,language_other_than_english_pct:a,english_less_than_very_well_pct:p,spanish_at_home_pct:d}),rt(P.demographics||{}),rt(C.demographics||{}),'<p class="section-description">This section highlights the primary and secondary languages spoken in the community and key language indicators based on American Community Survey (ACS) 5&#8209;year estimates.</p><p class="section-description"><em>Values for the surrounding 10-mile area and water district are population-weighted averages.</em></p>'),at=(w={})=>`<div class="kv">${[["White",E(w.white_pct)],["Black or African American",E(w.black_pct)],["American Indian / Alaska Native",E(w.native_pct)],["Asian",E(w.asian_pct)],["Native Hawaiian / Pacific Islander",E(w.pacific_pct)],["Other race",E(w.other_race_pct)],["Two or more races",E(w.two_or_more_races_pct)],["Hispanic",E(w.hispanic_pct)],["Not Hispanic",E(w.not_hispanic_pct)]].map(([M,U])=>`<div class="key">${M}</div><div class="val">${U}</div>`).join("")}</div>`,Xt=z("Race &amp; Ethnicity (ACS)",at({white_pct:F,black_pct:k,native_pct:R,asian_pct:N,pacific_pct:D,other_race_pct:L,two_or_more_races_pct:$,hispanic_pct:I,not_hispanic_pct:q}),at(P.demographics||{}),at(C.demographics||{}),'<p class="section-description">This section shows the racial and ethnic composition of the community, expressed as percentages of the total population using American Community Survey (ACS) data. These insights help identify the diversity of the area and support efforts to ensure programs, outreach, and engagement strategies reflect and serve all community groups.</p><p class="section-description"><em>Values for the surrounding 10-mile area and water district are population-weighted averages.</em></p>'),ot=(w={})=>`<div class="kv">${[["Owner occupied",E(w.owner_occupied_pct)],["Renter occupied",E(w.renter_occupied_pct)],["Median home value",pt(w.median_home_value)],["High school or higher",E(w.high_school_or_higher_pct)],["Bachelor's degree or higher",E(w.bachelors_or_higher_pct)]].map(([M,U])=>`<div class="key">${M}</div><div class="val">${U}</div>`).join("")}</div>`,Zt=z("Housing &amp; Education (ACS)",ot({owner_occupied_pct:x,renter_occupied_pct:B,median_home_value:G,high_school_or_higher_pct:j,bachelors_or_higher_pct:H}),ot(P.demographics||{}),ot(C.demographics||{}),'<p class="section-description">This section combines information on housing and educational attainment in the community. It includes the percentage of owner&#8209;occupied and renter&#8209;occupied homes, median home value, and levels of education such as high school completion and bachelor’s degree or higher. These indicators provide insight into community stability, affordability, and educational opportunities, helping inform outreach strategies and program planning.</p><p class="section-description"><em>Values for the surrounding 10-mile area and water district are population-weighted averages.</em></p>'),ct=(w,W,M,U)=>{const bt=Array.isArray(W)?W.length>0:!!w,ie=bt?"var(--success)":"var(--border-strong)",lt=[`Disadvantaged community: <strong>${bt?"Yes":"No"}</strong>`],Z=[];return Number.isFinite(M)&&Z.push(`<li><strong>${E(M)}</strong> of population</li>`),Number.isFinite(U)&&Z.push(`<li><strong>${E(U)}</strong> of tracts</li>`),Z.length&&lt.push(`<ul class="dac-stats">${Z.join("")}</ul>`),Array.isArray(W)&&W.length&&lt.push(`<div class="dac-tracts">Tracts ${W.map(re=>S(re)).join(", ")}</div>`),`<div class="callout" style="border-left-color:${ie}">${lt.join("")}</div>`},Qt=z("Disadvantaged Community (DAC) Status",ct(b),Array.isArray(P.dac_tracts)?ct(null,P.dac_tracts,P.dac_population_pct,P.dac_tracts_pct):"",Array.isArray(C.dac_tracts)?ct(null,C.dac_tracts,C.dac_population_pct,C.dac_tracts_pct):"",'<p class="section-description">This section indicates whether the selected area is designated as a Disadvantaged Community (DAC) using the California Department of Water Resources (DWR) mapping tool. DAC status is determined by household income and is shown as a simple yes/no outcome. This designation is important for identifying areas eligible for certain state and federal funding opportunities and for ensuring that equity considerations are included in outreach and program planning.</p>'),te=z("Environmental Indicators (CalEPA Enviroscreen)",dt(xt),dt(P.environment),dt(C.environment),'<p class="section-description">This section shows environmental and community health indicators from California’s Enviroscreen tool. Results are presented as percentiles, with higher numbers (and darker colors) indicating greater environmental burdens compared to other areas in the state. These measures include factors such as air quality, traffic pollution, and access to safe drinking water.</p><p class="section-description">Staff can use this information to understand potential environmental challenges facing a neighborhood, strengthen grant applications that require equity or environmental justice considerations, and design outreach that addresses local concerns. For example, if an event is planned in an area with a high Enviroscreen percentile, staff may want to highlight programs or benefits related to clean water, pollution reduction, or community health.</p><p class="section-description"><strong>How to Read This</strong><br>Green = Low burden (fewer environmental and health challenges)<br>Yellow/Orange = Moderate burden<br>Red = High burden (greater environmental and health challenges)<br>Percentile score shows how the community compares to others across California.</p>'),ee=z("Environmental Hardships",_t.length?`<div class="stats">${_t.map(w=>`<span class="pill">${S(w)}</span>`).join("")}</div>`:"",vt.length?`<div class="stats">${vt.map(w=>`<span class="pill">${S(w)}</span>`).join("")}</div>`:"",wt.length?`<div class="stats">${wt.map(w=>`<span class="pill">${S(w)}</span>`).join("")}</div>`:"",'<p class="section-description">This section lists environmental hardships reported for the selected location, highlighting challenges that may affect residents and program planning.</p>'),se=`
    <section class="section-block">
      <h3 class="section-header">Active Alerts (National Weather Service)</h3>
      <p class="section-description">This section displays any current weather alerts issued by the National Weather Service (NWS) for the selected location. Alerts may include warnings for extreme heat, flooding, wildfire smoke, or other hazardous conditions. Having this information alongside demographic and environmental data helps staff anticipate safety concerns for events, tailor outreach, and ensure programs are responsive to current community conditions.</p>
      ${yt.length?`<div class="stats">${yt.map(w=>`<span class="pill">${S(w)}</span>`).join("")}</div>`:'<p class="note">No active alerts found for this location.</p>'}
    </section>
  `,ne=`
    <div class="comparison-grid column-headers">
      <div class="col">Census tract</div>
      <div class="col">10 mile radius</div>
      <div class="col">Water district</div>
    </div>
  `;document.getElementById("result").innerHTML=`
    <article class="card">
      <div class="card__header">
        <div class="card__head-left">
          <h2 class="card__title">Results for: ${S(t)}</h2>
          <div class="card__actions">
            <button type="button" onclick="printReport()">Print</button>
            <button type="button" onclick="downloadPdf()">Download PDF</button>
            <button type="button" onclick="downloadRawData()">Raw Data</button>
            <button type="button" onclick="shareReport()">Share Link</button>
          </div>
        </div>
        <span class="updated">Updated ${mt()}</span>
      </div>
      ${ne}
      ${Yt}
      ${Jt}
      ${Kt}
      ${Xt}
      ${Zt}
      ${Qt}
      ${te}
      ${ee}
      ${se}
      <p class="note">Search took ${Dt(i)}.</p>
      <p class="note">Values for the surrounding 10-mile area and water district are population-weighted averages.</p>
      <span class="updated--footer">
        Sources: FCC Block for county &amp; tract; US Census ACS 5‑year (languages, population, median income); CalEnviroScreen 4.0; NWS alerts.
      </span>
    </article>
  `}async function It(){const t=document.getElementById("autocomplete"),n=document.getElementById("result"),i=((t==null?void 0:t.value)||"").trim();if(i.length<4){$t("Please enter a more complete address (at least 4 characters).",i,0);return}await ce();const r=i.toLowerCase();if(ut.has(r)){const e=ut.get(r);V={address:i,data:e};const s=new URL(window.location);s.searchParams.set("address",i),window.history.replaceState(null,"",s.toString()),Nt(i,e,0);return}n.setAttribute("aria-busy","true"),he(i);const o=document.getElementById("spinnerOverlay");o&&(o.style.display="flex"),be();let c=0;try{const e=st(Rt,{address:i});let s=await K(e);if(!s||typeof s!="object")throw new Error("Malformed response.");s=await O("enrichLocation",()=>Ae(s));const[l,p,a,d,_]=await Promise.all([O("fetchLanguageAcs",()=>$e(s)),O("enrichSurrounding",()=>Ne(s)),O("enrichWaterDistrict",()=>Fe(s,i)),O("enrichEnglishProficiency",()=>Re(s)),O("enrichNwsAlerts",()=>De(s))]);tt(s,l,p,a,d,_);const m=await O("enrichRegionBasics",()=>Se(s)),h=await O("enrichRegionHousingEducation",()=>Ee(s));tt(s,m,h);const[y,f,u]=await Promise.all([O("enrichRegionLanguages",()=>Ce(s)),O("enrichRegionHardships",()=>Pe(s)),O("enrichUnemployment",()=>ke(s))]);tt(s,y,f,u),V={address:i,data:s},ut.set(r,s);const g=new URL(window.location);g.searchParams.set("address",i),window.history.replaceState(null,"",g.toString()),c=Et(),Nt(i,s,c)}catch(e){c||(c=Et()),$t(String(e),i,c)}finally{const e=document.getElementById("spinnerOverlay");e&&(e.style.display="none"),n.removeAttribute("aria-busy")}}function Le(){const t=document.getElementById("lookupBtn");if(!t)return;const n=t.cloneNode(!0);t.replaceWith(n),n.addEventListener("click",i=>{i.preventDefault(),It().catch(console.error)})}Tt().catch(()=>{});window.onload=()=>{oe(),Le();const n=new URLSearchParams(window.location.search).get("address");if(n){const i=document.getElementById("autocomplete");i&&(i.value=n,It().catch(console.error))}};
